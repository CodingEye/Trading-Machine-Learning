# ðŸ” Backtesting for Intraday Trading ML

This file outlines the backtesting methodology used to evaluate trading signals generated by ML models on intraday (M5/M15) financial data.

---

## ðŸŽ¯ Objective

To simulate model-based trades using historical data and assess performance using metrics like accuracy, Sharpe ratio, drawdown, and win rate.

---

## âš™ï¸ Strategy Setup

### ðŸ” Inputs:
- M5 timeframe data (OHLCV + features)
- Model predictions (binary or multi-class labels)
- Entry/Exit conditions

### ðŸ’¡ Signal Logic:
```python
# For binary classifier
signal = (predicted_label == 1)
```

---

## ðŸ“ˆ Trade Simulation Engine

### ðŸ›  Core Logic:
```python
def backtest(df, signal_col, stop_loss=0.002, take_profit=0.004):
    trades = []
    for i in range(len(df)):
        if df[signal_col].iloc[i]:
            entry_price = df['close'].iloc[i]
            for j in range(i+1, min(i+20, len(df))):
                high, low = df['high'].iloc[j], df['low'].iloc[j]
                if high >= entry_price * (1 + take_profit):
                    trades.append(1)
                    break
                elif low <= entry_price * (1 - stop_loss):
                    trades.append(-1)
                    break
            else:
                trades.append(0)
    return trades
```

### ðŸ§® Output:
- `1`: Profit hit
- `-1`: Stop loss hit
- `0`: Neutral / exit at end of lookahead

---

## ðŸ“Š Metrics for Evaluation

| Metric         | Description                                |
|----------------|---------------------------------------------|
| Accuracy       | % of correct directional predictions        |
| Sharpe Ratio   | Risk-adjusted return                       |
| Max Drawdown   | Largest peak-to-valley loss                |
| Win Rate       | % of trades with positive return           |
| Avg Return     | Mean return per trade                      |
| Profit Factor  | Gross profit / Gross loss                 |


### Example Code:
```python
accuracy = (np.array(results) == 1).sum() / len(results)
sharpe = np.mean(returns) / np.std(returns)
```

---

## ðŸ§ª Walkforward / Rolling Backtest

- Divide historical data into sequential chunks (e.g. 1 month train, 1 week test)
- Re-train and re-test on sliding windows

### Benefits:
- Avoids lookahead bias
- Mimics real-time trading conditions


---

## ðŸ” Notes on Validity

- No future data is leaked into training
- Stop-loss / take-profit levels are realistic and broker-fee inclusive
- Slippage can optionally be modeled using random spread adjustments


---

## ðŸ“¦ Final Output

- Per-trade log: entry time, price, outcome
- Summary statistics (saved as CSV, JSON)
- Optional: equity curve plot via `matplotlib`


